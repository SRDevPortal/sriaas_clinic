<!-- Patient Encounter – New (sriaas_clinic) -->
<style>
  .pf { font-family: Inter, ui-sans-serif, system-ui; font-size: 12px; line-height: 1.35; color:#111; }
  .pf h1 { font-size: 18px; margin: 0 0 6px; }
  .pf h2 { font-size: 14px; margin: 14px 0 6px; }
  .pf table { width: 100%; border-collapse: collapse; }
  .pf th, .pf td { border: 1px solid #ddd; padding: 6px; text-align: left; vertical-align: top; }
  .pf .muted { color: #666; }
  .pf .row { display:flex; gap:16px; }
  .pf .col { flex: 1; }
  .right { text-align: right; }
  .nowrap { white-space: nowrap; }
</style>

<div class="pf">
  <h1>Patient Encounter</h1>
  <div class="muted">
    Print Date: {{ frappe.utils.format_datetime(frappe.utils.now_datetime()) }}
  </div>

  <div class="row">
    <div class="col">
      <h2>Encounter Info</h2>
      <table>
        <tr><th>No.</th><td>{{ doc.name }}</td></tr>
        <tr><th>Date</th><td>{{ frappe.utils.formatdate(doc.encounter_date) }} {{ doc.encounter_time or "" }}</td></tr>
        <tr><th>Type</th><td>{{ doc.sr_encounter_type or "" }}</td></tr>
        <tr><th>Place</th><td>{{ doc.sr_encounter_place or "" }}</td></tr>
        <tr><th>Sales Type</th><td>{{ doc.sr_sales_type or "" }}</td></tr>
        <tr><th>Delivery Type</th><td>{{ doc.sr_delivery_type or "" }}</td></tr>
        <tr><th>Encounter Source</th><td>{{ doc.sr_encounter_source or "" }}</td></tr>
        <tr><th>Status</th><td>{{ doc.sr_encounter_status or "" }}</td></tr>
        <tr><th>Company</th><td>{{ doc.company or "" }}</td></tr>
      </table>
    </div>
    <div class="col">
      <h2>Patient</h2>
      <table>
        <tr><th>Patient</th><td>{{ doc.patient_name or doc.patient }}</td></tr>
        <tr><th>Patient ID</th><td>{{ doc.sr_pe_id or "" }}</td></tr>
        <tr><th>Mobile</th><td>{{ doc.sr_pe_mobile or "" }}</td></tr>
        <tr><th>Department</th><td>{{ doc.sr_pe_deptt or "" }}</td></tr>
        <tr><th>Age</th><td>{{ doc.sr_pe_age or "" }}</td></tr>
        <tr><th>Practitioner</th><td>{{ doc.practitioner_name or doc.practitioner or "" }}</td></tr>
        <tr><th>Medical Department</th><td>{{ doc.medical_department or "" }}</td></tr>
      </table>
    </div>
  </div>

  {% if (doc.sr_complaints or doc.sr_observations or doc.sr_investigations or doc.sr_notes) %}
  <h2>Clinical Notes</h2>
  <table>
    {% if doc.sr_complaints %}<tr><th>Complaints</th><td>{{ doc.sr_complaints | nl2br }}</td></tr>{% endif %}
    {% if doc.sr_observations %}<tr><th>Observations</th><td>{{ doc.sr_observations | nl2br }}</td></tr>{% endif %}
    {% if doc.sr_investigations %}<tr><th>Investigations</th><td>{{ doc.sr_investigations | nl2br }}</td></tr>{% endif %}
    {% if doc.sr_notes %}<tr><th>Notes</th><td>{{ doc.sr_notes | nl2br }}</td></tr>{% endif %}
  </table>
  {% endif %}

  {% set ayu = doc.drug_prescription or [] %}
  {% if ayu|length > 0 %}
  <h2>Prescription (Ayurvedic)</h2>
  <table>
    <thead>
      <tr>
        <th class="nowrap">#</th>
        <th>Medication</th>
        <th>Dosage</th>
        <th>Period</th>
        <th>Form</th>
        <th>Instruction</th>
      </tr>
    </thead>
    <tbody>
      {% for r in ayu if (r.drug_name or r.drug or r.medication) %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ r.drug_name or r.drug or r.medication }}</td>
        <td>{{ r.dosage or r.dosage_strength or r.dose }}</td>
        <td>{{ r.period or r.periods or r.no_of_days }}</td>
        <td>{{ r.form or r.form_txt }}</td>
        <td>{{ r.instruction or r.comment or r.instruction_to_patient }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}

  {% set hom = doc.sr_homeopathy_drug_prescription or [] %}
  {% if hom|length > 0 %}
  <h2>Prescription (Homeopathy)</h2>
  <table>
    <thead>
      <tr>
        <th class="nowrap">#</th>
        <th>Medication</th>
        <th>Dosage</th>
        <th>Period</th>
        <th>Form</th>
        <th>Instruction</th>
      </tr>
    </thead>
    <tbody>
      {% for r in hom if (r.drug_name or r.drug or r.medication) %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ r.drug_name or r.drug or r.medication }}</td>
        <td>{{ r.dosage or r.dosage_strength or r.dose }}</td>
        <td>{{ r.period or r.periods or r.no_of_days }}</td>
        <td>{{ r.form or r.form_txt }}</td>
        <td>{{ r.instruction or r.comment or r.instruction_to_patient }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}

  {% set allo = doc.sr_allopathy_drug_prescription or [] %}
  {% if allo|length > 0 %}
  <h2>Prescription (Allopathy)</h2>
  <table>
    <thead>
      <tr>
        <th class="nowrap">#</th>
        <th>Medication</th>
        <th>Dosage</th>
        <th>Period</th>
        <th>Form</th>
        <th>Instruction</th>
      </tr>
    </thead>
    <tbody>
      {% for r in allo if (r.drug_name or r.drug or r.medication) %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ r.drug_name or r.drug or r.medication }}</td>
        <td>{{ r.dosage or r.dosage_strength or r.dose }}</td>
        <td>{{ r.period or r.periods or r.no_of_days }}</td>
        <td>{{ r.form or r.form_txt }}</td>
        <td>{{ r.instruction or r.comment or r.instruction_to_patient }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}

  {% if doc.sr_encounter_type and doc.sr_encounter_type.lower() == "order" %}
    <h2>Draft Invoice – Items</h2>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Item</th>
          <th>UOM</th>
          <th class="right">Qty</th>
          <th class="right">Rate</th>
          <th class="right">Amount</th>
        </tr>
      </thead>
      <tbody>
        {% set rows = doc.sr_pe_order_items or [] %}
        {% if rows|length == 0 %}
          <tr><td colspan="6" class="muted">No items</td></tr>
        {% else %}
          {% for r in rows %}
            {% set qty  = (r.sr_item_qty or r.qty or 0) | float %}
            {% set rate = (r.sr_item_rate or r.rate or 0) | float %}
            {% set amt  = qty * rate %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>
                <div><b>{{ r.sr_item_name or r.item_name or r.sr_item_code or r.item_code }}</b></div>
                {% if r.sr_item_description or r.description %}
                  <div class="muted">{{ r.sr_item_description or r.description }}</div>
                {% endif %}
              </td>
              <td>{{ r.sr_item_uom or r.uom }}</td>
              <td class="right">{{ frappe.utils.fmt_money(qty, 0) }}</td>
              <td class="right">{{ frappe.utils.fmt_money(rate) }}</td>
              <td class="right">{{ frappe.utils.fmt_money(amt) }}</td>
            </tr>
          {% endfor %}
        {% endif %}
      </tbody>
    </table>

    <h2>Advance Payment</h2>
    <table>
      <tr><th>Mode of Payment</th><td>{{ doc.sr_pe_mode_of_payment or "" }}</td></tr>
      <tr><th>Paid Amount</th><td>{{ frappe.utils.fmt_money(doc.sr_pe_paid_amount or 0) }}</td></tr>
      <tr><th>Reference No</th><td>{{ doc.sr_pe_payment_reference_no or "" }}</td></tr>
      <tr><th>Reference Date</th><td>{{ frappe.utils.formatdate(doc.sr_pe_payment_reference_date) if doc.sr_pe_payment_reference_date else "" }}</td></tr>
    </table>
  {% endif %}

  {% if doc.sr_pe_instruction %}
    <h2>Instructions</h2>
    <div>{{ doc.sr_pe_instruction | nl2br }}</div>
  {% endif %}
</div>
